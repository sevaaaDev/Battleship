(()=>{"use strict";const t={container:"kxQvc8rJ79LoRKCb8nOw",board:"IHitRuohOL4qlMoFBkaz",ship:"xhijktdZIHkpEbIdnr7q",allowDrag:"unuiIUTqHLly_isWNV_e",dim:"DGzypBuW903zUseFSAf4",drag:"xl5X9JLCFwVNR_vLWgUa",hit:"sMVWb7CXKixybHKg2dRz",miss:"p9GjbDR6kAa4yEqEiKuh",bigTitle:"KiH48s1aEIEMYcvc1l7P",mainBoardWrapper:"rpCX3Ix39WdIUuL2NEPg",boardName:"sHptOvwqD8gAFBGqgM4x",boardsContainer:"QjeE9ix9AFDgKci062o6",listOfShips:"Kryf4fNGscPaTcbPaBdQ",buttonContainer:"wV9aQdKDwBBuyayZ0MQQ",listOfShipsLeft:"Wp4dmQx7zm2btPjILr1a Kryf4fNGscPaTcbPaBdQ",listOfShipsRight:"tHT_FBdqArTSJigc6KXV Kryf4fNGscPaTcbPaBdQ",shipSunk:"GFyG59Tn8_wedBl3tx8R",smallTile:"joDO4L7ynzzyiBfDO5bq",messageInfo:"HKzLKt73qZpk67_NMg3L"};const e={html:function(){document.querySelector("body").innerHTML=`\n<header>\n  <h1 class='${t.bigTitle}'>Battleship</h1>\n</header>\n<main class='${t.container}'>\n  <section class='${t.messageInfo}'>\n    <p>Drag ship to move <br> Click ship to rotate</p>\n  </section>\n  <section class='${t.boardsContainer}'>\n    <section class='${t.mainBoardWrapper}' data-board='player'>\n        <div class='${t.listOfShipsLeft}' data-board='player' style='display:none'></div>\n      <section class='${t.boardWrapper}'>\n        <div class='${t.board}' data-board='player' ondragstart="() => false"></div>\n        <h3 class='${t.boardName}'>PLAYER</h3>\n      </section>\n    </section>\n    <section class='${t.mainBoardWrapper}' data-board='computer' style='display:none'>\n      <section class='${t.boardWrapper}'>\n        <div class='${t.board}' data-board='computer' ondragstart="() => false"></div>\n        <h3 class='${t.boardName}'>COMPUTER</h3>\n      </section>\n        <div class='${t.listOfShipsRight}' data-board='computer' style='display:none'></div>\n    </section>\n  </section>\n  <section class='${t.buttonContainer}'>\n    <button type='button'data-type='start'>Start</button>\n  </section>\n</main>\n`},board:function(e,i,s){let a=document.querySelector(`div[data-board="${i}"].${t.board}`);a.innerHTML="";for(let n=9;n>=0;n--)for(let o=0;o<10;o++){let r=document.createElement("div");r.setAttribute("data-x",o),r.setAttribute("data-y",n),r.ondragstart=()=>!1,"player"===i&&r.setAttribute("data-drop",!0),"object"==typeof e.board[o][n]&&(s&&r.classList.add(`${t.ship}`),"player"===i&&(r.classList.add(`${t.allowDrag}`),"player"===i&&r.setAttribute("data-ship",!0))),"missed"===e.board[o][n]&&r.classList.add(`${t.miss}`),"hit"===e.board[o][n]&&r.classList.add(`${t.hit}`),a.append(r)}},listOfShips:function(e,i){const s=document.querySelector(`div[data-board='${i}'].${t.listOfShips}`);s.innerText="";for(let i of e){const e=document.createElement("div");e.setAttribute("data-ship",i.name);for(let s=0;s<i.length;s++){const i=document.createElement("div");i.classList.add(`${t.smallTile}`),e.append(i)}s.append(e)}},button:function(e){const i=document.querySelector(`.${t.buttonContainer}`),s=document.createElement("button");s.setAttribute("type","button"),s.setAttribute("data-type",e),s.innerText=e[0].toUpperCase().concat(e.slice(1)),i.append(s)}};function i(e){e.classList.remove(`${t.dim}`)}function s(e){document.querySelector(`.${t.messageInfo} p`).innerText=e}const a={tile:function(e,i,s,a){"missed"!==e?"hit"!==e||function(e,i,s){let a=document.querySelector(`div[data-board='${e}'] div[data-x='${i}'][data-y='${s}']`);a.classList.remove(`${t.ship}`),a.classList.add(`${t.hit}`)}(i,s,a):function(e,i,s){let a=document.querySelector(`div[data-board='${e}'] div[data-x='${i}'][data-y='${s}']`);a.classList.remove(`${t.disabled}`),a.classList.add(`${t.miss}`)}(i,s,a)},listOfShips:function(e,i){for(let s of e){const e=document.querySelector(`div[data-board='${i}'] div[data-ship='${s.name}']`);s.isSunk()&&e.classList.add(`${t.shipSunk}`)}},removeCursorDrag:function(){document.querySelectorAll(`div[data-board='player'] div.${t.ship}`).forEach((e=>{e.classList.remove(`${t.allowDrag}`)}))},removeDisplayNone:function(){document.querySelectorAll("[style='display:none']").forEach((t=>{t.removeAttribute("style")}))},messageInfo:s,info:function(t){"missed"!==t?"hit"!==t||s("You fired a shot and its a hit"):s("You fired a shot and misses")},toggleDimBoard:function(e){document.querySelector(`section[data-board='${e}'].${t.mainBoardWrapper}`).classList.add(`${t.dim}`),i("player"!==e?document.querySelector(`section[data-board='player'].${t.mainBoardWrapper}`):document.querySelector(`section[data-board='computer'].${t.mainBoardWrapper}`))}},n={isSunk:function(){return!this.health&&(this.sunk=!0,!0)},hit:function(){this.health&&this.health--}};function o(t,e,i,s){const a={listCoordinate:[]};return a.head=[t,e],a.tail=[t+s-1,e],"y"===i&&(a.tail=[t,e+s-1]),a}function r(t){const e=function(){let t=0;return function(){let e=[{name:"Carrier",length:5},{name:"Battleship",length:4},{name:"Destroyer",length:3},{name:"Submarine",length:3},{name:"Patrol",length:2}];return t>e.length-1&&(t=0),e[t++]}}();let i=l();for(let s=0;s<5;s++){const s=e();let{coordinate:a,orient:n}=d(t,s,i,"x");c(i,s.length,a,n)}}function d(t,e,i,s){let[a,r]=function(t){return t[Math.floor(Math.random()*(t.length-1))]}(i,e.length),c=o(a,r,s,e.length),l=t.placeShip(function({length:t,name:e,orient:i,shipPosition:s}){const a=Object.create(n);return a.length=t,a.name=e,a.health=t,a.sunk=!1,a.orientation=i,a.position=s,a}({...e,shipPosition:c,orient:s}));return s="x"===s?"y":"x",l?{coordinate:[a,r],orient:s}:d(t,e,i,s)}function c(t,e,i,s){let a=i.slice();for(let i=0;i<e;i++)"x"===s?t.splice(t.indexOf([a[0]++,a[1]]),1):t.splice(t.indexOf([a[0],a[1]++]),1)}function l(){let t=[];for(let e=0;e<10;e++)for(let i=0;i<10;i++)t.push([e,i]);return t}const h={placeShip(t){let e=t.length,i=t.orientation,s=t.name,[a,n]=t.position.head,o=t.position.listCoordinate;if(!this.isOutside(a,n,e,i)&&!this.isThereAShip(a,n,e,i,s)&&!this.isTooCloseToOtherShip(a,n,e,i,s)){for(let s=0;s<e;s++)this.board[a][n]=t,o.push({x:a,y:n}),"x"!==i?n++:a++;return this.ships.push(t),!0}},moveShip(t,e,i){this.removeShip(...t);let s=o(...e,i.orientation,i.length);i.position=s,this.placeShip(i)},isTooCloseToOtherShip(t,e,i,s,a){for(let n=0;n<i;n++){for(let i of this.graph[`${t},${e}`]){let[t,e]=i.split(",");if("object"==typeof this.board[t][e]&&this.board[t][e].name!==a)return!0}"x"!==s?e++:t++}return!1},isThereAShip(t,e,i,s,a){for(let n=0;n<i;n++){if("object"==typeof this.board[t][e]&&this.board[t][e].name!==a)return!0;"x"!==s?e++:t++}return!1},removeShip(t,e){let i=this.board[t][e];for(let t of i.position.listCoordinate)this.board[t.x][t.y]=void 0;let s=this.ships.indexOf(i);this.ships.splice(s,1)},isOutside:(t,e,i,s)=>t<0||t>9||e<0||e>9||("x"===s?t+i-1>9:e+i-1>9),receiveAttack([t,e]){let i;return!this.isOutside(t,e)&&"hit"!==this.board[t][e]&&("object"==typeof this.board[t][e]&&(this.board[t][e].hit(),i="hit",this.attack.push({x:t,y:e}),this.board[t][e]="hit"),void 0===this.board[t][e]&&(i="missed",this.missedAttack.push({x:t,y:e}),this.board[t][e]="missed"),i)},areAllSunk(){let t=this.checkShip();return!(this.ships.length-t)},thisShipSunk(){let t=this.checkShip();return this.numOfSunkShip!==t&&(this.numOfSunkShip=t,!0)},checkShip(){let t=0;for(let e of this.ships)e.isSunk()&&t++;return t},reset(){this.missedAttack=[],this.attack=[],this.board=m(),this.ships=[],this.graph=u()}};function u(){let t={};for(let e=0;e<10;e++)for(let i=0;i<10;i++){let s=p(e,i);t[`${e},${i}`]=s}return t}function p(t,e){let i=[];return i.push(`${t+1},${e}`),i.push(`${t-1},${e}`),i.push(`${t},${e+1}`),i.push(`${t},${e-1}`),i.push(`${t+1},${e+1}`),i.push(`${t+1},${e-1}`),i.push(`${t-1},${e+1}`),i.push(`${t-1},${e-1}`),i.filter((t=>{let e=t.split(",");if(e[0]<10&&e[0]>-1&&e[1]<10&&e[1]>-1)return!0}))}function m(){let t=[];for(let e=0;e<10;e++){t.push([]);for(let i=0;i<10;i++)t[e].push(void 0)}return t}function f(){const t=Object.create(h);return t.missedAttack=[],t.attack=[],t.board=m(),t.ships=[],t.numOfSunkShip=0,t.graph=u(),t}let v={chooseCoord(){let[t,e]=this.attackRandom();return(this.isPreviousMoveHit||this.stack.x.length+this.stack.y.length!==0)&&([t,e]=this.smartAttack(this.isPreviousMoveHit,this.previousMove)),-1===e&&([t,e]=this.attackRandom()),this.moves.splice(e,1),this.previousMove=t,t},smartAttack(t,e){return this.isPreviousShipSunk?(this.attackDirection="x",this.stack.x=[],this.stack.y=[],[void 0,-1]):(t||0!==this.stack.x.length||(this.attackDirection="y"),this.stack.y.length||"y"===this.attackDirection||this.fillStackQueue("y",e),!0===t&&this.fillStackQueue(this.attackDirection,e),this.getSmartMove(this.attackDirection))},fillStackQueue(t,e){let i=0;"y"===t&&(i=1);let s=[...e];s[i]--,this.checkCoordinate(...s)&&this.stack[t].push(s);let a=[...e];a[i]++,this.checkCoordinate(...a)&&this.stack[t].push(a)},getSmartMove(t){let e=this.stack[t].pop();return void 0===e?[e,-1]:[e,this.getCoordinateIndex(...e)]},removeMove(t){let e=this.getCoordinateIndex(...t);this.moves.splice(e,1)},attackRandom(){const t=Math.floor(Math.random()*(this.moves.length-1)),e=this.moves[t];return e?[e,t]:"finish"},changePreviousMoveStatus(t){this.isPreviousMoveHit="missed"!==t},getCoordinateIndex(t,e){let i=-1;return this.moves.map(((s,a)=>{s[0]===t&&s[1]===e&&(i=a)})),i},checkCoordinate(t,e){let i=!1;return this.moves.map((s=>{s[0]===t&&s[1]===e&&(i=!0)})),i},changePreviousShipStatus(t){this.isPreviousShipSunk=t}};function b(){let t=l();const e={get moves(){return t},isPreviousMoveHit:null,previousMove:null,stack:{x:[],y:[]},attackDirection:"x",isPreviousShipSunk:!1,reset(){t=l()}};return Object.setPrototypeOf(e,v),e}const y=t=>new Promise((e=>setTimeout(e,t)));function g(t,i){e.html(),e.board(t,"player",!0),e.board(i,"computer",!1),e.listOfShips(t.ships,"player"),e.listOfShips(i.ships,"computer")}!function(){let i=f(),s=f(),n=b();function o(t){t.target.matches('[data-ship="true"]')&&function(t,e,i){let s=i.board[t][e],a=s.position.head,n=s.orientation;n="x"===n?"y":"x";let o=s.length;return!(i.isOutside(...a,o,n)||i.isThereAShip(...a,o,n,s.name)||i.isTooCloseToOtherShip(...a,o,n,s.name)||(s.orientation=n,i.moveShip(a,a,s),0))}(+t.target.dataset.x,+t.target.dataset.y,i)&&e.board(i,"player",!0)}function d(s){s.target.matches('[data-ship="true"]')&&(s.target.releasePointerCapture(s.pointerId),function(e,i,s){let a,n=e.target,o=!1;function r(e){e.preventDefault(),o=!0,function(e,i,s){let[a,n]=[+e.target.dataset.x,+e.target.dataset.y],[o,r]=[+e.relatedTarget.dataset.x,+e.relatedTarget.dataset.y],{x:d,y:c}=i.dataset,l=s.board[+d][+c],h=parseInt(l.length),u=l.name,p=l.orientation;isNaN(o)||s.isOutside(o,r,h,p)||function(e,i,s,a){for(let n=0;n<s;n++)document.querySelector(`div[data-board="player"] div[data-x="${e}"][data-y="${i}"]`).classList.remove(`${t.drag}`),"x"!==a?i++:e++}(o,r,h,p),e.target.dataset.drop&&(s.isOutside(a,n,h,p)||s.isThereAShip(a,n,h,p,u)||s.isTooCloseToOtherShip(a,n,h,p,u)||function(e,i,s,a){for(let n=0;n<s;n++)document.querySelector(`div[data-board="player"] div[data-x="${e}"][data-y="${i}"]`).classList.add(`${t.drag}`),"x"!==a?i++:e++}(a,n,h,p))}(e,n,i)}function d(){document.removeEventListener("pointerover",r)}document.addEventListener("pointerover",r,{passive:!1}),document.addEventListener("pointerup",(function(t){document.removeEventListener("pointerover",r),document.removeEventListener("pointercancel",d),a=t.target,o&&a.dataset.drop&&(function(t,e,i){let{x:s,y:a}=t.dataset,[n,o]=[+e.dataset.x,+e.dataset.y],r=i.board[s][a];if(!r)return;let d=parseInt(r.length),c=r.orientation,l=r.name,h=[parseInt(s),parseInt(a)],u=[n,o];i.isOutside(n,o,d,c)||i.isThereAShip(n,o,d,c,l)||i.isTooCloseToOtherShip(n,o,d,c,l)||i.moveShip(h,u,r)}(n,a,i),s(i,"player",!0))}),{once:!0}),document.addEventListener("pointercancel",d,{once:!0})}(s,i,e.board))}async function c(t){if(t.target.matches("div[data-board='computer'] div")){let e=t.target.dataset.x,o=t.target.dataset.y;await async function(t,e){document.removeEventListener("click",c);const o=s.receiveAttack([t,e]);if(!o)return;if(a.tile(o,"computer",t,e),s.thisShipSunk()&&(a.messageInfo("Enemy's ship has been sunk"),await y(1200)),a.listOfShips(s.ships,"computer"),s.areAllSunk())return void l("Player");a.messageInfo("Computer Turn"),a.toggleDimBoard("computer"),await y(1e3);const r=n.chooseCoord(),d=i.receiveAttack(r);n.changePreviousMoveStatus(d),n.changePreviousShipStatus(!1),a.tile(d,"player",...r),i.thisShipSunk()&&(n.changePreviousShipStatus(!0),a.messageInfo("Your ship has been sunk"),await y(1200)),a.listOfShips(i.ships,"player"),i.areAllSunk()?l("Computer"):(a.messageInfo("Your Turn"),a.toggleDimBoard("player"),document.addEventListener("click",c))}(e,o)}}function l(t){document.removeEventListener("click",c),a.messageInfo(`${t} Won`),e.board(s,"computer",!0)}r(i),r(s),g(i,s),document.addEventListener("click",(function(t){t.target.matches("button[data-type='restart']")&&(i=f(),s=f(),n=b(),r(i),r(s),g(i,s),document.removeEventListener("click",c),document.addEventListener("pointerdown",d),document.addEventListener("click",o))})),document.addEventListener("click",(function(t){t.target.matches('button[data-type="start"]')&&(document.removeEventListener("pointerdown",d),document.removeEventListener("click",o),document.addEventListener("click",c),a.removeCursorDrag(),a.removeDisplayNone(),a.messageInfo("Your Turn"),t.target.remove(),e.button("restart"))})),document.addEventListener("pointerdown",d,{passive:!1}),document.addEventListener("click",o)}()})();